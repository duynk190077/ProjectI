<header class="header">
    <div class="grid">
        <nav class="header__navbar">
            <ul class="header__navbar-list">
                <li class="header__navbar-items header__navbar-items--qr header__navbar-items--separate">
                    Vào cửa hàng trên ứng dụng ProjectI
                    <div class="header__qr">
                        <img src="../../public/img/qrcode.png" alt="QR code" class="header__qr-img">
                        <div class="header__qr-download">
                            <a href="" class="header__qr-link">
                                <img src="../../public/img/google_play.jpg" alt="GooglePlay" class="header__qr-download-img header__qr-download-img--gg">
                            </a>
                            <a href="" class="header__qr-link">
                                <img src="../../public/img/apple_store.jpg" alt="AppStore" class="header__qr-download-img header__qr-download-img--app">
                            </a>
                        </div>
                    </div>
                </li>
                <li class="header__navbar-items">
                    <span class="header__navbar-items--no-pointer">Kết nối</span>
                    <a href="" class="header_navbar-icon-link">
                        <i class="header_navbar-icon fab fa-facebook"></i>
                    </a>
                    <a href="" class="header_navbar-icon-link">
                        <i class="header_navbar-icon fab fa-instagram"></i>
                    </a>
                </li>  
            </ul>
            <ul class="header__navbar-list">
                <li class="header__navbar-items">
                    <a href="" class="header__navbar-link">
                        <i class="header_navbar-icon far fa-bell"></i>
                        Thông báo
                    </a>
                    <div class="header__notify">
                        <header class="header__notify-header">
                            <h3>Thông Báo Mới Nhận</h3>
                        </header>
                        <ul class="header__notify-list">
                            <li class="header__notify-item header__notify-item--viewed">
                                <a href="" class="header__notify-link">
                                    <img src="../../public/img/Ohui Korea.jpg" class="header__notify-img">
                                    <div class="header__notify-info">
                                        <span class="header__notify-name">Mỹ phẩm Ohui chính hãng</span>
                                        <span class="header__notify-descriotion">Mô tả mỹ phẩm Ohui chính hãng</span>
                                    </div>
                                </a>
                            </li>
                            <li class="header__notify-item header__notify-item--viewed">
                                <a href="" class="header__notify-link">
                                    <img src="../../public/img/Ohui Korea.jpg" class="header__notify-img">
                                    <div class="header__notify-info">
                                        <span class="header__notify-name">Mỹ phẩm Ohui chính hãng</span>
                                        <span class="header__notify-descriotion">Mô tả mỹ phẩm Ohui chính hãng</span>
                                    </div>
                                </a>
                            </li>
                            <li class="header__notify-item .header__notify-item--viewed">
                                <a href="" class="header__notify-link">
                                    <img src="../../public/img/Ohui Korea.jpg" class="header__notify-img">
                                    <div class="header__notify-info">
                                        <span class="header__notify-name">Mỹ phẩm Ohui chính hãng </span>
                                        <span class="header__notify-descriotion">Mô tả mỹ phẩm Ohui chính hãng</span>
                                    </div>
                                </a>
                            </li>
                        </ul>
                        <footer class="header__notify-footer">
                            <a href="" class="header__notify-footer-btn">Xem tất cả</a>
                        </footer>
                    </div>
                </li>
                <li class="header__navbar-items">
                    <a href="" class="header__navbar-link">
                        <i class="header_navbar-icon far fa-question-circle"></i>
                        Trợ giúp
                    </a>
                </li>
                {{!-- overlay --}}
                <div class="modal modal-login">
                    <div class="modal__overlay"></div>
                    <div class="modal__body">
                        <div class="auth-form author-form-login">
                        <div class="auth-form__container">
                            <div class="auth-form__header">
                                <h3 class="auth-form__heading">Đăng nhập</h3>
                                <span class="auth-form__switch-btn">Đăng kí</span>
                            </div>
                            <div class="auth-form__form">
                                <div class="auth-form__group">
                                    <input type="text" class="auth-form__input" placeholder="username">
                                </div>
                                <div class="auth-form__group">
                                    <input type="password" class="auth-form__input" placeholder="password">
                                </div> 
                            </div>
                            <div class="auth-form__aside">
                                <div class="auth-form__help">
                                    <a href="" class="auth-form__help-link auth-form__help-fogot">
                                        Quên mật khẩu
                                    </a>
                                    <span class="auth-form__help-separate"></span>
                                    <a href="" class="auth-form__help-link auth-form__help-">
                                        Cần trợ giúp?
                                    </a>
                                </div>
                            </div>
                            <div class="auth-form__controls">
                                <button class="btn btn--normal auth-form__controls-back">TRỞ LẠI</button>
                                <button class="btn btn--primary">ĐĂNG NHẬP</button>
                            </div>
                        </div>
                        <div class="auth-form__social">
                            <a href="" class="auth-form__social--facebook btn btn--size-s btn--withicon">
                                <i class="auth-form__social-icon fab fa-facebook-square"></i>
                                <span class="auth-form__social-lable">Connect with Facebook</span>
                            </a>
                            <a href="" class="auth-form__social--google btn btn--size-s btn--withicon">
                                <i class="auth-form__social-icon fab fa-google"></i>
                                <span class="auth-form__social-lable">Connect with Google</span>
                            </a> 
                        </div>
                        </div>
                    </div>
                </div>
                <a href="/register">
                    <li class="header__navbar-items header__navbar-items--strong header__navbar-items--separate link-register">Đăng kí</li>
                </a>
                <a href="/login">
                    <li class="header__navbar-items header__navbar-items--strong link-login">Đăng nhập</li>
                </a>
                <li class="header__navbar-items header__navbar-user admin">
                    <img class = "header__navbar-user-avt admin" src="">
                    <span class="header__navbar-user-name admin"></span>
                    <ul class="header__navbar-user-menu">
                        <li class="header__navbar-user-items">
                            <a onclick="createItem()">Thêm mặt hàng mới</a>
                        </li>
                        <li class="header__navbar-user-items">
                            <a onclick="listItem()">Danh sách mặt hàng</a>
                        </li>
                        <li class="header__navbar-user-items">
                            <a onclick="addNumItem()">Thêm hàng vào kho</a>
                        </li>
                        <li class="header__navbar-user-items header__navbar-user-items--separate">
                            <a class="header__navbar-user-logout" onclick="logout()">Đăng xuất</a>
                        </li>
                    </ul>
                </li>
                <li class="header__navbar-items header__navbar-user user">
                    <img class = "header__navbar-user-avt user" src="">
                    <span class="header__navbar-user-name user"></span>
                    <ul class="header__navbar-user-menu">
                        <li class="header__navbar-user-items">
                            <a href="/users/account">Tài khoản của tôi</a>
                        </li>
                        <li class="header__navbar-user-items">
                            <a href="/users/purchases">Đơn hàng mua</a>
                        </li>
                        <li class="header__navbar-user-items header__navbar-user-items--separate">
                            <a href="" class="header__navbar-user-logout" onclick="logout()">Đăng xuất</a>
                        </li>
                    </ul>
                </li>
            </ul>

        </nav>
        <!-- Header-with-search -->
        <div class="header-with-search">
            <div class="header__logo">
                <a href="/" class="header__logo-link">
                    <img src="https://adev42.com/frontend/assets/f8-shop/img/logo-72.svg" alt="logo">
                </a>
            </div>
            <div class="header__search">
                <div class="header__search-input-wrap">
                    <input type="text" class="header__search-input" placeholder="Tìm kiếm trong shop này">
                    <!-- search h -->
                    <div class="header__search-history">
                        <h3 class="header__search-history-heading">Lịch sử tìm kiếm</h3>
                        <ul class="header__search-history-list">
                            <li class="header__search-history-items">
                                <a href="" class="header__search-history-link">Son môi</a>
                            </li>
                            <li class="header__search-history-items">
                                <a href="" class="header__search-history-link">Giày adidas</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="header__search-select">
                    <span class="header__search-select-bridge"></span>
                    <span class="header__search-select-label">Trong shop</span>
                    <i class="header__search-select-icon fas fa-angle-down"></i>
                    <ul class="header__search-option">
                        <li class="header__search-option-items">
                            <span>Trong shop</span>
                            <i class="fas fa-check"></i>
                        </li>
                        <li class="header__search-option-items">
                            <span>Ngoài shop</span>
                            <i class="fas fa-check"></i>
                        </li>
                    </ul>
                </div>
                <button class="header__search-btn">
                    <i class="header__search-btn-icon fas fa-search"></i>
                </button>
            </div>
            <div class="header__cart">
                <div class="header__cart-wrap">
                    <i class="header__cart-icon fas fa-shopping-cart"></i>
                    <span class="header__cart-notice"></span>
                    <div class="header__cart-list-div">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form class="form-order" method="GET" action="/orders"></form>
</header>
<script>
    const itemRegister = $('.header__navbar-items.link-register');
    const itemLogin = $('.header__navbar-items.link-login');
    const navUser = $('.header__navbar-items.header__navbar-user.user');
    const navUsername = $('.header__navbar-user-name.user');
    const navAdmin = $('.header__navbar-items.header__navbar-user.admin');
    const navAdminname = $('.header__navbar-user-name.admin');
    const token = localStorage.getItem('token');
    const role = localStorage.getItem('role');
    const getOrder = $('.form-order');
    var cartNum = $('.header__cart-notice');
    const cartList = $('.header__cart-list-div');
    var orders;
    if (token) {
        itemLogin.css('display', 'none');
        itemRegister.css('display', 'none');
        if (role === 'user') {
            navUser.css('display', 'flex');
            navUsername.text(localStorage.getItem('username'));
        }
        else {
            navAdmin.css('display', 'flex');
            navAdminname.text(localStorage.getItem('username'));
        }
    }
    else {
        itemLogin.css('display', 'flex');
        itemRegister.css('display', 'flex');
        navUser.css('display', 'none');
        navAdmin.css('display', 'none');
    }
    if (token) {
        $(window).on('load', function() {
            $.ajax({
                url: '/orders',
                type: 'GET',
                headers: {'authorization': 'bearer ' + localStorage.getItem('token')},
            }).then(data => {
                localStorage.setItem("orders", JSON.stringify(data.orders));
                orders = JSON.parse(localStorage.getItem('orders'));
                tableOrder(data.orders);
            })
        })
    }
    else {
        cartNum.removeClass('header__cart-notice');
        cartNum.text('');
    }
    function tableOrder(orders) {
        var len = orders.length;
        if (len === 0) {
            cartNum.removeClass('header__cart-notice');
            cartNum.text('');
            const nocartList = document.createElement('div');
            nocartList.classList.add('header__cart-list');
            nocartList.classList.add('header__cart-list-no-cart');
            nocartList.innerHTML = `
                <img src="../../public/img/no_cart.png" alt="" class="header__cart-no-cart-img">
                <span class="header__cart-list-no-cart-noti">
                    Chưa có sản phẩm
                </span>
            `;
            cartList.append(nocartList);
        }
        else {
            const havecartList = document.createElement('div');
            havecartList.classList.add('header__cart-list');
            havecartList.classList.add('header__cart-list-have-cart');
            havecartList.innerHTML = `
                <h4 class="header__cart-heaeding">
                    Sản phẩm đã thêm
                </h4>
            `;
            var btnCart = document.createElement('button');
            btnCart.classList.add('btn', 'btn--primary', 'header__cart-btn');
            btnCart.innerHTML = `Xem giỏ hàng`;
            var cartListItems = document.createElement('ul');
            cartListItems.classList.add('header__cart-list-items');
            cartNum.addClass('header__cart-notice');
            cartNum.text(len);
            for (let i = 0; i < len; i++) {
                const cartItem = document.createElement('li');
                cartItem.classList.add('header__cart-items');
                cartItem.innerHTML = `
                    <img src="${orders[i].item_img}" alt="" class="header__cart-items-img">
                    <div class="header__cart-items-info">
                        <div class="header__cart-items-head">
                            <h5 class="header__cart-items-name">
                                ${orders[i].item_name}
                            </h5>
                            <div>
                                <span class="header__cart-items-price">${orders[i].price}đ</span>
                                <span class=header__cart-items-multiply>x</span>
                                <span class="header__cart-items-number">${orders[i].num}</span>
                            </div>
                        </div>
                        <div class="header__cart-items-body">
                            <span class="header__cart-items-delete">Xóa</span>
                        </div>
                    </div>
                `;
                cartListItems.appendChild(cartItem);
            }
            havecartList.appendChild(cartListItems);
            havecartList.appendChild(btnCart);
            cartList.append(havecartList);
        }
        const deleteOrder = $('.header__cart-items-delete');
        for (let i = 0; i < deleteOrder.length; i++) {
        deleteOrder[i].addEventListener('click', function (e) {
            $.ajax({
                url: '/orders/delete',
                type: 'DELETE',
                headers: {'authorization': 'bearer ' + localStorage.getItem('token')},
                data: {_id: orders[i]._id}
            }).then(data => {
                if (data.status === 'ok') window.location.href = window.location.pathname;
                })
            e.preventDefault();
            })
        }
        btnCart.addEventListener('click', function (e) {
            $.ajax({
                url: '/private/orders/detail',
                type: 'GET', 
                headers: {'authorization': 'bearer ' + localStorage.getItem('token')},
            })
            .then(data => {
                if (data.status === 'ok') window.location.href = '/orders/detail'
            })
        })
    }
</script>
<script src="../../public/javascripts/logout.js"></script>
<script src="../../public/javascripts/create-item.js"></script>
<script src="../../public/javascripts/list-item.js"></script>
<script src="../../public/javascripts/addnum-item.js"></script>
